<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ§ THE PERMANENT SCRAPBOOK âœ§</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <style>
        :root {
            --bg: #0d0d0d; --accent: #bfff00; --secondary: #ff00ff;
            --card-bg: #1a1a1a; --text: #ffffff; --font: 'VT323', monospace;
        }
        body.kawaii-mode {
            --bg: #fff0f5; --accent: #ff69b4; --secondary: #87ceeb;
            --card-bg: #ffffff; --text: #4b0082;
        }
        body { background: var(--bg); color: var(--text); font-family: var(--font); padding: 20px; transition: 0.3s; overflow-x: hidden; }
        
        #bio-header { border: 3px double var(--accent); padding: 20px; text-align: center; margin-bottom: 20px; background: var(--card-bg); }
        #stat-box { display: inline-block; padding: 5px 15px; border: 1px dashed var(--secondary); margin: 10px 0; }

        .side-nav { position: fixed; right: 20px; bottom: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 1000; }
        .symbol-btn { 
            background: var(--card-bg); border: 2px solid var(--accent); color: var(--accent);
            width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 1.5rem; cursor: pointer; box-shadow: 4px 4px 0 var(--secondary);
            transition: 0.2s;
        }

        #search-container { max-width: 500px; margin: 0 auto 20px auto; }
        #search-bar { width: 100%; padding: 10px; background: #000; border: 2px solid var(--secondary); color: var(--accent); font-family: var(--font); font-size: 1.2rem; outline: none; }

        #scrapbook-content { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .project-card { 
            width: 100%; max-width: 380px; background: var(--card-bg); border: 3px solid var(--secondary); 
            padding: 15px; position: relative; box-shadow: 10px 10px 0px var(--accent);
        }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: #000; border: 1px solid var(--secondary); color: var(--secondary); cursor: pointer; font-size: 1.2rem; padding: 0 5px; }
        
        .media-preview { width: 100%; height: 300px; object-fit: cover; border: 1px solid var(--accent); margin-top: 10px; }

        input, .btn { width: 100%; background: #000; border: 1px solid var(--accent); color: var(--accent); padding: 12px; margin: 5px 0; font-family: var(--font); font-size: 1.2rem; box-sizing: border-box; }
        .btn { cursor: pointer; font-weight: bold; background: var(--accent); color: #000; border: none; }
        
        #upload-status { display: none; margin-top: 10px; color: var(--accent); text-align: center; font-weight: bold; }
        .hidden { display: none; }

        .nav-menu { text-align: center; font-size: 2rem; margin: 20px 0; }
        .nav-item { cursor: pointer; transition: 0.2s; }
    </style>
</head>
<body>

    <div id="bio-header">
        <h1 style="color:var(--secondary); font-size: 3rem; margin:0;">2026</h1>
        <div id="stat-box">PROJECTS_LOGGED: <span id="count-num">0</span></div>
        <p onclick="editBio()" id="bio-text">"Crocheting my way through the year..." (Tap to edit)</p>
    </div>

    <button class="btn" style="width:auto; float:right;" onclick="document.body.classList.toggle('kawaii-mode')">âŠ¹ VIBE SWITCH âŠ¹</button>

    <div class="nav-menu">
        <span class="nav-item" onclick="showView('journal')">âœ¦ SCRAPBOOK</span> | 
        <span class="nav-item" onclick="showView('add')">âœ¦ ADD_ENTRY</span>
    </div>

    <div id="search-container">
        <input type="text" id="search-bar" placeholder="ðŸ” Search projects..." onkeyup="filterProjects()">
    </div>

    <div id="add-view" class="hidden">
        <div style="max-width:500px; margin:auto; border:3px solid var(--secondary); padding:25px; background:var(--card-bg); position:relative;">
            <button onclick="showView('journal')" style="position:absolute; top:10px; right:10px; color:var(--accent); background:none; border:1px solid var(--accent); cursor:pointer;">[X]</button>
            <h2 style="color:var(--accent)">> UPLOAD_MEMORY</h2>
            <input type="text" id="name" placeholder="Project Name">
            <input type="text" id="hook" placeholder="Hook Size">
            <input type="text" id="yarn" placeholder="Yarn Brand & Color">
            <input type="text" id="stitches" placeholder="Stitches Used">
            <input type="url" id="tutorial" placeholder="Tutorial Link">
            <input type="date" id="proj-date">
            <input type="file" id="mediaInput" multiple accept="image/*,video/*">
            <button class="btn" id="save-btn" onclick="uploadToFirebase()">SAVE TO DATABASE ðŸ’¾</button>
            <div id="upload-status">SIGNALING SATELLITE... DO NOT CLOSE PAGE</div>
        </div>
    </div>

    <div id="journal-view">
        <div id="scrapbook-content"></div>
    </div>

    <div class="side-nav">
        <div class="symbol-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">âœ§</div>
        <div class="symbol-btn" onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})">âœ¦</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDPbpS_DrMA_iMNQAPVBtIpleGlfBY77eQ",
            authDomain: "crochet-journal-12ef5.firebaseapp.com",
            projectId: "crochet-journal-12ef5",
            storageBucket: "crochet-journal-12ef5.firebasestorage.app",
            messagingSenderId: "547985781877",
            appId: "1:547985781877:web:282850f0501f7eab18f43c"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        let allProjects = [];

        function showView(v) {
            document.getElementById('add-view').classList.toggle('hidden', v !== 'add');
            document.getElementById('journal-view').classList.toggle('hidden', v !== 'journal');
            document.getElementById('search-container').classList.toggle('hidden', v === 'add');
        }

        async function uploadToFirebase() {
            const files = document.getElementById('mediaInput').files;
            if(files.length === 0) return alert("Pick files first!");

            const btn = document.getElementById('save-btn');
            const status = document.getElementById('upload-status');
            
            btn.disabled = true;
            btn.innerText = "SIGNALING...";
            status.style.display = 'block';

            try {
                const mediaLinks = [];
                for (let file of files) {
                    const ref = storage.ref(`2026/${Date.now()}_${file.name}`);
                    // Using put() with task to ensure it completes
                    const task = await ref.put(file);
                    const url = await task.ref.getDownloadURL();
                    mediaLinks.push({ url, type: file.type });
                }

                await db.collection("projects").add({
                    name: document.getElementById('name').value || "Project",
                    hook: document.getElementById('hook').value || "",
                    yarn: document.getElementById('yarn').value || "",
                    stitches: document.getElementById('stitches').value || "",
                    tutorial: document.getElementById('tutorial').value || "",
                    date: document.getElementById('proj-date').value || new Date().toISOString(),
                    media: mediaLinks
                });

                // THE POPUP YOU ASKED FOR
                alert("âœ¦ SUCCESS: MEMORY SAVED TO THE SATELLITE âœ¦");
                location.reload();
            } catch (e) { 
                console.error(e);
                alert("CRITICAL ERROR: Connection to Satellite lost. Check file size!"); 
                btn.disabled = false; 
                status.style.display = 'none'; 
                btn.innerText = "SAVE TO DATABASE ðŸ’¾";
            }
        }

        function filterProjects() {
            const term = document.getElementById('search-bar').value.toLowerCase();
            const cards = document.getElementsByClassName('project-card');
            Array.from(cards).forEach(card => {
                const text = card.innerText.toLowerCase();
                card.style.display = text.includes(term) ? "block" : "none";
            });
        }

        async function deleteProject(id) {
            if(confirm("Permanently delete this memory?")) {
                await db.collection("projects").doc(id).delete();
            }
        }

        function loadData() {
            db.collection("projects").orderBy("date", "desc").onSnapshot(snap => {
                const cont = document.getElementById('scrapbook-content');
                cont.innerHTML = '';
                document.getElementById('count-num').innerText = snap.size;
                snap.forEach(doc => {
                    const p = doc.data();
                    const media = p.media && p.media.length > 0 ? p.media[0] : null;
                    const mediaTag = media && media.type.includes('video') 
                        ? `<video src="${media.url}" class="media-preview" controls></video>` 
                        : `<img src="${media ? media.url : ''}" class="media-preview">`;

                    cont.innerHTML += `
                        <div class="project-card">
                            <button class="delete-btn" onclick="deleteProject('${doc.id}')">âœ–</button>
                            ${mediaTag}
                            <h2 style="color:var(--accent); margin:10px 0;">${p.name}</h2>
                            <p><b>HOOK:</b> ${p.hook} | <b>YARN:</b> ${p.yarn}</p>
                            <p><b>DATE:</b> ${new Date(p.date).toLocaleDateString()}</p>
                            ${p.tutorial ? `<a href="${p.tutorial}" target="_blank" style="color:var(--secondary)">[SOURCE_LINK]</a>` : ''}
                        </div>`;
                });
            });
        }
        loadData();
    </script>
</body>
</html>
